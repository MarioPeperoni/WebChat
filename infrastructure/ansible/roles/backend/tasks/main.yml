- name: Authenticate to ECR
  shell: |
    aws ecr get-login-password --region eu-north-1 | \
    docker login --username AWS --password-stdin {{ ecr_url }}
  register: ecr_login
  changed_when: "'Login Succeeded' in ecr_login.stdout"

- name: Pull latest backend image
  docker_image:
    name: "{{ ecr_url }}:latest"
    source: pull
    force_source: true

- name: Run backend container
  docker_container:
    name: webchat-backend
    image: "{{ ecr_url }}:latest"
    state: started
    restart_policy: always
    recreate: true
    ports:
      - "8000:8000"